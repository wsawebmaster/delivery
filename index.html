<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cardápio de Lanches</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            background-color: #f3f4f6;
            margin: 0;
            padding: 20px;
            color: #333;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 20px;
        }

        #menu {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            flex-grow: 1;
        }

        .menu-item {
            background: #fff;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            padding: 20px;
            text-align: center;
            transition: transform 0.3s;
        }

        .menu-item:hover {
            transform: translateY(-5px);
        }

        .quantity-controls {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 10px;
        }

        .quantity-controls button {
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 5px 10px;
            margin: 0 5px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .quantity-controls button:hover {
            background-color: #2980b9;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.7);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal-content {
            background: #fff;
            padding: 20px;
            border-radius: 8px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .close-button {
            background-color: #e74c3c;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 10px;
            cursor: pointer;
            float: right;
        }

        .close-button:hover {
            background-color: #c0392b;
        }

        .total {
            font-weight: bold;
            font-size: 1.2em;
            margin-top: 10px;
        }

        button.finalize {
            background-color: #e74c3c;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 10px 20px;
            cursor: pointer;
            font-size: 1em;
            margin-top: 20px;
            display: block;
            width: 100%;
            transition: background-color 0.3s;
        }

        button.finalize:hover {
            background-color: #c0392b;
        }

        .bottom-menu {
            display: none;
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: #fff;
            box-shadow: 0 -2px 5px rgba(0, 0, 0, 0.1);
            padding: 10px 20px;
            justify-content: space-between;
            align-items: center;
        }

        .total-value {
            font-size: 1.2em;
            color: #2c3e50;
        }

        .cart-button {
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 10px 20px;
            cursor: pointer;
            transition: background-color 0.3s;
            display: none;
        }

        .cart-button.show {
            display: inline-block;
        }

        .cart-button:hover {
            background-color: #2980b9;
        }

        .input-field {
            margin-top: 10px;
            margin-bottom: 10px;
            width: 100%;
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }

        .bairro-list {
            margin-top: 10px;
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid #ccc;
            border-radius: 4px;
            padding: 10px;
            background: #f9f9f9;
        }
    </style>
</head>

<body>

    <h1>Cardápio de Lanches</h1>

    <section id="menu">
        <div class="menu-item">
            <div class="quantity-controls">
                <button onclick="changeQuantity('X Burguêr', 12, -1)">-</button>
                <span id="quantity-X Burguêr">0</span>
                <button onclick="changeQuantity('X Burguêr', 12, 1)">+</button>
            </div>
            <strong>X Burguêr</strong> - R$ 12,00
        </div>
        <div class="menu-item">
            <div class="quantity-controls">
                <button onclick="changeQuantity('X Egg Bacon', 16, -1)">-</button>
                <span id="quantity-X Egg Bacon">0</span>
                <button onclick="changeQuantity('X Egg Bacon', 16, 1)">+</button>
            </div>
            <strong>X Egg Bacon</strong> - R$ 16,00
        </div>
        <div class="menu-item">
            <div class="quantity-controls">
                <button onclick="changeQuantity('X Salada', 17, -1)">-</button>
                <span id="quantity-X Salada">0</span>
                <button onclick="changeQuantity('X Salada', 17, 1)">+</button>
            </div>
            <strong>X Salada</strong> - R$ 17,00
        </div>
        <div class="menu-item">
            <div class="quantity-controls">
                <button onclick="changeQuantity('X Salada Egg', 20, -1)">-</button>
                <span id="quantity-X Salada Egg">0</span>
                <button onclick="changeQuantity('X Salada Egg', 20, 1)">+</button>
            </div>
            <strong>X Salada Egg</strong> - R$ 20,00
        </div>
        <div class="menu-item">
            <div class="quantity-controls">
                <button onclick="changeQuantity('X Tudo', 28, -1)">-</button>
                <span id="quantity-X Tudo">0</span>
                <button onclick="changeQuantity('X Tudo', 28, 1)">+</button>
            </div>
            <strong>X Tudo</strong> - R$ 28,00
        </div>
    </section>

    <div class="modal" id="cartModal">
        <div class="modal-content">
            <button class="close-button" onclick="closeModal()">Fechar</button>
            <h2>Seu Carrinho</h2>
            <ul id="cartItems"></ul>
            <div id="bairroInfo"></div>
            <div class="total" id="totalValue">Total dos Itens: R$ 0,00</div>
            <div class="total" id="freteValue">Valor da Entrega: R$ 0,00</div>
            <div class="total" id="finalTotal">Total Geral: R$ 0,00</div>

            <button onclick="exibirBairrosAtendidos()">Bairros Atendidos</button>
            <div id="bairroList" class="bairro-list" style="display: none;">
                <h4>Bairros Atendidos:</h4>
                <ul>
                    <li>Jardim Antártica</li>
                    <li>Vila Tibério</li>
                    <li>Jardim Paiva</li>
                </ul>
            </div>

            <input type="text" id="cepInput" class="input-field" placeholder="Informe seu CEP"
                onblur="buscarEndereco()" />
            <div id="enderecoInfo" class="input-field" style="margin-top: 10px; display: none;"></div>
            <input type="text" id="numeroInput" class="input-field" placeholder="Número da Residência" />
            <input type="text" id="pontoReferenciaInput" class="input-field" placeholder="Ponto de Referência" />

            <input type="text" id="clienteNome" class="input-field" placeholder="Seu Nome" />
            <input type="text" id="clienteTelefone" class="input-field" placeholder="Seu Telefone" />

            <select id="formaPagamento" class="input-field">
                <option value="" disabled selected>Selecione a forma de pagamento</option>
                <option value="Pix">Pix</option>
                <option value="Dinheiro">Dinheiro</option>
                <option value="Cartão">Cartão</option>
            </select>


            <button class="finalize" onclick="finalizeOrder()">Finalizar Pedido</button>
        </div>
    </div>

    <div class="bottom-menu" id="bottomMenu">
        <div class="total-value" id="bottomTotalValue">Subtotal: R$ 0,00</div>
        <button class="cart-button" id="cartButton" onclick="toggleCart()">Carrinho</button>
    </div>

    <script>
        let cart = [];
        let total = 0;
        let bairroValor = 0;
        let bairroNome = "";
        let enderecoBase = "";

        function changeQuantity(name, price, change) {
            const quantityElement = document.getElementById(`quantity-${name}`);
            let quantity = parseInt(quantityElement.textContent) || 0;
            quantity += change;

            if (quantity < 0) quantity = 0;
            quantityElement.textContent = quantity;

            if (quantity > 0) {
                const existingItem = cart.find(item => item.name === name);
                if (existingItem) {
                    existingItem.quantity = quantity;
                } else {
                    cart.push({ name, price, quantity });
                }
                document.getElementById('cartButton').classList.add('show');
                document.getElementById('bottomMenu').style.display = 'flex';
            } else {
                cart = cart.filter(item => item.name !== name);
                if (cart.length === 0) {
                    document.getElementById('cartButton').classList.remove('show');
                    document.getElementById('bottomMenu').style.display = 'none';
                }
            }

            updateCart();
        }

        function updateCart() {
            const cartItems = document.getElementById('cartItems');
            cartItems.innerHTML = '';
            total = 0;

            cart.forEach(item => {
                const itemTotal = item.price * item.quantity;
                total += itemTotal;
                const li = document.createElement('li');
                li.textContent = `${item.quantity} x ${item.name} - R$ ${itemTotal.toFixed(2).replace('.', ',')}`;
                cartItems.appendChild(li);
            });

            const freteElement = document.getElementById('freteValue');
            if (bairroNome) {
                freteElement.textContent = `Valor da Entrega: R$ ${bairroValor.toFixed(2).replace('.', ',')}`;
            } else {
                freteElement.textContent = `Valor da Entrega: R$ 0,00`;
            }

            document.getElementById('totalValue').textContent = `Total dos Itens: R$ ${total.toFixed(2).replace('.', ',')}`;
            updateFinalTotal();
        }

        function buscarEndereco() {
            const cep = document.getElementById('cepInput').value.replace(/\D/g, '');
            if (cep.length === 8) {
                fetch(`https://viacep.com.br/ws/${cep}/json/`)
                    .then(response => response.json())
                    .then(data => {
                        if (data.erro) {
                            alert("CEP não encontrado.");
                        } else {
                            bairroNome = data.bairro;
                            const bairrosValidos = ["Jardim Antártica", "Vila Tibério", "Jardim Paiva"];
                            if (!bairrosValidos.includes(bairroNome)) {
                                alert("Não entregamos no bairro informado.");
                                bairroNome = "";
                                bairroValor = 0; // Adicione esta linha para zerar o valor se o bairro não for atendido
                                document.getElementById('enderecoInfo').style.display = 'none';
                            } else {
                                document.getElementById('bairroInfo').textContent = `Bairro: ${bairroNome}`;
                                bairroValor = 5;
                                enderecoBase = `${data.logradouro}, ${data.bairro}, ${data.localidade} - ${data.uf}`;
                                const enderecoInfo = document.getElementById('enderecoInfo');
                                enderecoInfo.textContent = enderecoBase;
                                enderecoInfo.style.display = 'block';
                            }
                            // ✅ AQUI É O PONTO CHAVE: CHAME updateCart() AQUI!
                            updateCart();
                        }
                    })
                    .catch(error => {
                        console.error("Erro ao buscar o endereço:", error);
                        alert("Erro ao buscar o endereço. Verifique o CEP.");
                    });
            } else {
                alert("Por favor, informe um CEP válido.");
            }
        }

        function exibirBairrosAtendidos() {
            const bairroList = document.getElementById('bairroList');
            bairroList.style.display = bairroList.style.display === 'none' ? 'block' : 'none';
        }

        function updateFinalTotal() {
            const finalTotal = total + bairroValor;
            document.getElementById('finalTotal').textContent = `Total Geral: R$ ${finalTotal.toFixed(2).replace('.', ',')}`;
            document.getElementById('bottomTotalValue').textContent = `Subtotal: R$ ${total.toFixed(2).replace('.', ',')}`;
        }

        function finalizeOrder() {
            if (cart.length === 0) {
                alert("Seu carrinho está vazio!");
                return;
            }

            if (bairroValor === 0) {
                alert("Necessário selecionar um bairro antes de finalizar o pedido.");
                return;
            }

            const clienteNome = document.getElementById('clienteNome').value;
            const clienteTelefone = document.getElementById('clienteTelefone').value;
            const pontoReferencia = document.getElementById('pontoReferenciaInput').value;
            const numeroResidencia = document.getElementById('numeroInput').value;
            const formaPagamento = document.getElementById('formaPagamento').value;

            if (!clienteNome || !clienteTelefone || !numeroResidencia || !formaPagamento) {
                alert("Por favor, preencha nome, telefone e número da residência e forma de pagamento..");
                return;
            }

            const enderecoCompleto = enderecoBase.replace(",", `, ${numeroResidencia},`);


            let message = `*Olá, Fabin Lanches!*%0A%0A✅ _Segue meu pedido de hoje:_%0A%0A`;
            cart.forEach(item => {
                message += `${item.quantity} - ${item.name} - R$ ${(item.price * item.quantity).toFixed(2).replace('.', ',')}%0A`;
            });
            message += `%0ATaxa de Entrega: R$ ${bairroValor.toFixed(2).replace('.', ',')}%0A🤑 *Total do Pedido: R$ ${(total + bairroValor).toFixed(2).replace('.', ',')}*%0A💳 Pagamento por: ${formaPagamento}%0A%0A🛵 Endereço de entrega:%0A${enderecoCompleto}%0A📍 Ponto de Referência: ${pontoReferencia}%0A📞 Telefone: ${clienteTelefone}%0A%0A*Aguardo ansiosamente! 😋*`;

            const whatsappLink = `https://api.whatsapp.com/send?phone=5511982470496&text=${message}`;
            window.open(whatsappLink, '_blank');
        }

        function toggleCart() {
            const modal = document.getElementById('cartModal');
            modal.style.display = modal.style.display === 'flex' ? 'none' : 'flex';
            modal.style.justifyContent = 'center';
            modal.style.alignItems = 'center';
        }

        function closeModal() {
            document.getElementById('cartModal').style.display = 'none';
        }
    </script>
</body>

</html>